<!DOCTYPE html>
<html lang="en,default">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="This blog post follows my previous post “Getting started with SonarQube on a C# project”.In my first attempt of integrating TeamCity and SonarQube I t">
    

    <!--Author-->
    
        <meta name="author" content="Maarten De Raedemaeker">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Setting up TeamCity SonarQube integration for a C# project"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Maarten De Raedemaeker"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Setting up TeamCity SonarQube integration for a C# project - Maarten De Raedemaeker</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/images/theming/favicon.png">
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Maarten De Raedemaeker</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/maartenderaedemaeker">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/images/theming/background.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Setting up TeamCity SonarQube integration for a C# project</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Maarten De Raedemaeker on
                        
                        
                            2017-07-22
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/SonarQube/">#SonarQube</a> <a href="/tags/Code-quality/">#Code quality</a> <a href="/tags/Automation/">#Automation</a> <a href="/tags/Teamcity/">#Teamcity</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/categories/Software-development/">Software development</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>This blog post follows my previous post <a href="/2017/07/23/getting-started-with-sonarqube-on-a-csharp-project/">“Getting started with SonarQube on a C# project”</a>.<br>In my first attempt of integrating TeamCity and SonarQube I tried to use <a href="https://confluence.jetbrains.com/display/TW/SonarQube+Integration" target="_blank" rel="noopener">TeamCity SonarQube plugin</a>, but it seems to be abandoned as the specific documentation for the runner this plugin relies on doesn’t seem to exist anymore <a href="http://docs.codehaus.org/display/SONAR/Analysis+Parameters" target="_blank" rel="noopener">runner documentation</a>.<br>That’s why this post will just use the command-line tools available, with the added bonus advantage of easier portability over different types of build servers.<br>You can check out the source code analyzed at <a href="https://github.com/maartenderaedemaeker/Automated-SecurityTesting-Demo/tree/part1" target="_blank" rel="noopener">github</a>.</p>
<h1 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h1><ul>
<li>Step 1: Installing the tools</li>
<li>Step 2: Setting up a build configuration for SonarQube analysis</li>
</ul>
<h1 id="Step-1-Installing-the-tools"><a href="#Step-1-Installing-the-tools" class="headerlink" title="Step 1: Installing the tools"></a>Step 1: Installing the tools</h1><p>We’re going to install some dependencies on the build agent.<br>First off, <a href="https://chocolatey.org/install" target="_blank" rel="noopener">install chocolatey</a>.<br>After that, install SonarQube runner.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install -y microsoft-build-tools msbuild-sonarqube-runner</span><br></pre></td></tr></table></figure></p>
<h1 id="Step-2-Setting-up-a-build-configuration"><a href="#Step-2-Setting-up-a-build-configuration" class="headerlink" title="Step 2: Setting up a build configuration"></a>Step 2: Setting up a build configuration</h1><p>Since this is a new project in TeamCity, I’ll start with creating a project.</p>
<p><img src="/images/2017/07/23/Teamcity-SonarQube-3.png" alt="Teamcity-SonarQube-3"></p>
<p>After clicking through the wizard, TeamCity discovered one build step for my project.<br>I’d like to start with a clean slate and click on configure build steps manually.</p>
<p><img src="/images/2017/07/23/Teamcity-SonarQube-4.png" alt="Teamcity-SonarQube-4"></p>
<p>We’re going to create 4 build steps.<br><img src="/images/2017/07/23/Teamcity-SonarQube-5.png" alt="Teamcity-SonarQube-5"></p>
<ul>
<li>Step 1:<br>  Runner type: “NuGet Installer”<br>  This step will restore the NuGet packages required for building the solution.</li>
<li><p>Step 2:<br>  Runner type: “Command Line”</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SonarQube.Scanner.MSBuild.exe begin /k:&quot;%sonar.project%&quot; </span><br><span class="line">    /d:&quot;sonar.host.url=%sonar.host.url%&quot; /d:&quot;sonar.login=%sonar.login%&quot; </span><br><span class="line">    /d:&quot;sonar.organization=%sonar.organization%&quot; /v:&quot;%build.number%&quot;</span><br></pre></td></tr></table></figure>
<p>  This step is used to hook in the SonarQube runner into the msbuild process.<br>  You’ll notice the parameters enclosed with %’s. More on that later.</p>
</li>
<li>Step 3:<br>  Runner type: “MSBuild”<br>  This step will build the solution.</li>
<li>Step 4:<br>  Runner type: “Command line”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SonarQube.Scanner.MSBuild.exe end /d:&quot;sonar.login=%sonar.login%&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>This step will submit the analysis to SonarQube.</p>
<p>After defining these steps we’ll also need to define the parameters used in the commands.<br>Using these allows us to only need to change their value in one place. If you want, you could set this parameters globally at your root project, or for all your builds on this specific project.<br><img src="/images/2017/07/23/Teamcity-SonarQube-6.png" alt="Teamcity-SonarQube-6"></p>
<h1 id="Step-3-Test-the-configuration"><a href="#Step-3-Test-the-configuration" class="headerlink" title="Step 3: Test the configuration"></a>Step 3: Test the configuration</h1><p>There we go, now you can press the run build button to see if it works! :-)<br>If all went well you should now have a basic working build configuration.<br>Now you can start tweaking the configuration to fit your needs. Good luck!</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
    <hr />
    <h3>Comments:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/maartenderaedemaeker" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://www.linkedin.com/in/maartenderaedemaeker/" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2018 Maarten De Raedemaeker<br></p>
               </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'maarten-de-raedemaeker';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>